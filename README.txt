----------------------------------------------------------------------------------------------------------------------------------
Robust switches in thalamic network activity require a timescale separation between sodium and T-type calcium channel activations
Kathleen Jacquerie and Guillaume Drion
(October 2020) Julia and Matlab codes related to the article
----------------------------------------------------------------------------------------------------------------------------------


• All code has been checked but is provided *without support or guarantees*
• Please cite the paper if you use the code


You will find a description of the different files and folders below. The first part is composed of the codes used to obtain each figure. The second part describes the codes present in each folder. Don’t forget to add the correct directory in main Julia or Matlab files. Most of the codes take a relatively long amount of time to be run. The data generated by Julia codes are too heavy to be uploaded in the Github, it is the reason why data.dat files are removed. If you are interested in these data, please contact us. Since we use uniform distributions to produce variability in parameter spaces, it is likely that you might not have the exact same results. However, the conclusion remains the same.



-------------------------
 FIGURE 1 | Single-cells
-------------------------

--- Figure 1A ---
Hyperpolarization-induced bursting recording in model 1 (Drion model).

• File: Single-cells>Drion>…
• Run [Julia] Simu_Drion.jl (adapt directory name to save data; writedlm)
• Saved data: 
where? in Single-cells>Drion>V>…
what? time array (t_HIB.dat) and voltage membrane array (V_HIB.dat)
• Plot recording [Matlab] Single-cells>_Analysis>plot_expm.m
• Saved and save figure: Single-cells>_Analysis>Figures>V>Drion_HIB.pdf (ou Drion_HIB.eps)

--- Figure 1B ---
Modified version of Python code from [Alonso and Marder, 2019] Alonso, L. M. and Marder, E. (2019). Visualization of currents in neural models with similar behavior and different conductance densities. eLife, 8:1–28.
Code unavailable | ask permission to the author

--- Figure 1C ---
Hyperpolarization-induced bursting for different values of the membrane capacitance in model 1 (Drion), model 5 (Wang) and model 5’ (WangCa).

For each model, change the folder name.
• File: Singles-cells>name>…
• Run [Julia] Simu_name_plotC.jl (adapt directory name to save data; writedlm)
• Saved data: 
where? in Single-cells>name>V>…
what? 
Nominal value of C: time array (t_C1.dat) and voltage membrane array (V_C1.dat)
Modified value of C: time array (t_C0.dat) and voltage membrane array (V_C0.dat)
• Plot and save figure [Matlab] Single-cells>_Analysis>Figures>V>name_C0.pdf

--- Figure 1D ---
Quantification of switching neuron for varying membrane capacitance value.

• File: Single-cells>name>…
• Run [Julia] Simu_name_logC.jl (adapt directory name to save data; writedlm)
• Saved data: 
Where? In Single-cells>name>Map>…
What? C value array (Cvec.dat), current hyperpolarizing (Ivec.dat), binary matrix (element ij is binary: 1 the neuron has switched, otherwise 0 for C=Cvec(i) and Ivec(j)) (switch_TOT.dat)
• Data analysis [Matlab] Single-cells>_Analysis>Map_logC.m 
• Data plot [Excel]


--------------------
 FIGURE 2 | Network
--------------------

--- Figure 2A ---
Illustration of a rhythmic network from model 1 (Drion) and arrhythmic network from model 5 (Wang)

• File: Network>name>…
• Run [Julia] Simu_name_ncells_4steps.jl  (adapt directory name to save data; writedlm)
• Saved data: 
	Where? In Network>name>V>…
	What? Time array (t_ok for rhythmic network recording or t_ko for an arrhythmic network recording) and membrane voltage (resp.V_ok.dat and V_ko.dat)
• Plot and save figure [Matlab] Network>_Analysis>plot_expm.m

--- Figure 2B ---
Quantitative analysis of rhythmic networks subjected to variabilities onto synaptic conductances and intrinsic conductances.
Source: [Drion et al., 2018] Drion, G., Dethier, J., Franci, A., and Sepulchre, R. (2018). Switchable slow cellular conductances determine robustness and tunability of network states. PLoS Computational Biology, 14(4):1–20.

• File: Network>name>…
• Run [Julia] Simu_name_ncells_gamma.jl (adapt directory folder to save data; cd and writedlm)
• Saved data: 
	Where? In Network>name>Results_GAMMA>…
		Gamma represents the width of the variability interval around nominal values (in %)
	What? 
DC_depol1.dat	value of the duty cycle during depolarization phase
DC_hyperpol1.dat	value of the duty cycle during the hyperpolarization phase
Freq_depol1.dat	value of the tonic frequency during the depolarization phase
Freq_hyperpol1.dat	value of the tonic frequency during the hyperpolarization phase
IBF_depol1.dat	value of the intraburst frequency during the depolarization phase
IBF_hyperpol1.dat	value of the intraburst frequency during the hyperpolarization phase
PER_depol1.dat	value of the bursting period during the depolarization phase
PER_hyperpol1.dat	value of the bursting period during the hyperpolarization phase
SPB_depol1.dat	value of number of spikes per burst during the depolarization phase
SPB_hyerpol1.dat	value of number of spikes per burst during the hyperpolarization phase

• Data analysis [Matlab] Network>_Analysis>switch_bar.m
• Data plot [Matlab & Excel] Network>_Analysis>switch_bar.m 


---------------
 Figure 3 | Tau
---------------

--- Figure 3A ---
[Power point] Schematic draw of the computational experiment 


--- Figure 3B ---
Voltage-dependent time constants are evaluated at Vth. 
• Run: tau_collect.m
• Data: matrix T_TOT


--- Figure 3C-D ---
Effect on a varying CaT activation time constant on rhythmic network robustness.

• File: Tau>_Analysis>…
• Run [Matlab]: tau_collect.m
• Saved figures: Tau>_Analysis>Figures> TOT_TAU20_new.pdf and SUP_TAU20_new.pdf

-----------------
 Figure 4 | LFP
-----------------

--- Figure 4A-4C ---
[Power point] Schematic network draw


--- Figure 4B- Figure 4D ---
LFP recording of model 1 (Drion) and model 5 (Wang) for no intrinsic and synaptic variabilities. 
Top: evolution of LFP
Bottom: spectrogram of LFP

• File: LFP>name> 
• Run [Julia] Simu_name_LFP_4steps.jl (adapt directory name; writedlm)
• Saved data: #1: total number of cells in the network, #2: variability width in %.
	Where? LFP>name>Results_LFP> n_#1>gamma_#2
	What? LFP_E_#2.dat , LFP_I_#2.dat
• Data analysis and plot [Matlab] LFP>_Analysis>
	plot_LFP.m : plot LFP recording and save it in LFP>_Analysis>Figures>V>LFPtracename_#2.pdf
	LFP_figure_modele.m: plot spectrogram of LFP recording and 
• Plots are saved in LFP>_Analysis>Figures>name_LFP_E_n#1_#2.eps


--------------------
 Figure 5 | LFP_tau
--------------------

--- Figure 5A --- 
[Power point] Schematic draw of the computational experiment.

--- Figure 5B ---
Figures are extracted from Figure 5 to illustrate how we sort data.

--- Figure 5C ---
[Power point] summary of LFP recording and spectrogram analysis 
(that can be found in LFP_TAU>_Analysis>Figures>name>…) 
Functions

--------------------
 Figure 6 | DIC
--------------------

Simulations of the reduced models under different activation of the T-type calcium channel: A. membrane voltage recordings, B. Phase portrait in tonic mode, C. Phase portrait at the saddle node bifurcation.
All the data were previously saved in saveNULL.mat

• File: DIC>Drion>phaseplane>...
• Run: Final_Figure.m
• Saved Figures: >Fig/PP_[varNAME]_V.eps (for the membrane voltage time-course), Fig/PP_[varNAME]_tonic.eps (for the phase portrait during tonic mode) and Fig/PP_[varNAME]_SN.eps (for the phase portrait at the saddle node bifurcation)
The variable 'idx' indicates the line in saveNULL.mat at a given multiplicative factors of tau_mCaT
idx=5 : fast activation - varNAME= 50
idx=10: slow activation - varNAME = 1
idx=15: ultraslow activation - varNAME=550

Details about each fonction is given in section --- Folder: DIC ---


--------------------
 Figure 7 | DIC
--------------------
Simulations of the reduced models under different values of the membrane capacitance: 

--- Figures A
• File: DIC>Drion>phaseplane>...
• Run: Final_Figure_CVar.m
• Saved Figures: >Fig/C[value]_V.eps (for the membrane voltage time course), Fig/C[value]_SN.eps (phase portrait at the saddle node bifurcation)

--- Figures B
• File: DIC>Wang>phaseplane>...
• Run: Final_Figure_CVar.m
• Saved Figures: >Fig/C[value]_V.eps (for the membrane voltage time course), Fig/C[value]_SN.eps (phase portrait at the saddle node bifurcation)


----------------------
 Video S1 to S3 | DIC
----------------------
Video of the evolution of the membrane voltage and its associated phase portrait under different kinetics of the CaT channel activation (for the reduced model 1). 

• File: DIC>Drion>phaseplane>...
• Run: Simu_Drion_DIC_KD.m
• Saved videos: video_PP_50.mp4 (fast) [S1], video_PP_1.mp4 (slow) [S2], video_PP_550.mp4 (ultraslow) [S3]

----------------------
 Video S4    | DIC
----------------------
Video of the phase portrait distortion when the time constant is scaled from a small value (fast activation) to a large value (ultraslow activation). 

• File: DIC>Drion>...
• Run: video_PP_deform.m
• Saved video: in the current folder: sample.mp4

The code loops into saveNULL.mat where the phase portrait of the reduced model 1 was saved (thanks to calcul_SN.m). 

----------------------
 Video S5-S6 | DIC
----------------------
Video of the evolution of the membrane voltage and its associated phase portrait at two given membrane capacitance value for the reduced model 1. 

• File: DIC>Drion>phaseplane>...
• Run: Simu_Drion_DIC_KD_C.m
• The variable 'idx' indicates the colonne in saveC.mat at a given multiplicative factors of tau_mCaT
idx=10: slow activation - varNAME = 1
idx_C indicates the line in saveC.mat for a given membrane capacitance value.
• Saved videos: video_C1.mp4 (nominal value of Cm) [S7] and video_C2.mp4 (Cm/3) [S8]


----------------------
 Video S7-S8 | DIC
----------------------
Video of the evolution of the membrane voltage and its associated phase portrait at two given membrane capacitance value for the reduced model 5.

• File: DIC>Wang>phaseplane>...
• Run: Simu_Wang_DIC_Cvar.m
• idx_C indicates the line in saveC.mat for a given membrane capacitance value.
• Saved videos: video_C1.mp4 (nominal value of Cm) [S7] and video_C2.mp4 (Cm/3) [S8]


----------------------
 Folder: Single-cells
----------------------

--- Map_logC.m
From Julia data (the neuron is switching or not), this function finds the hyperpolarizing current generating the most robust when C is varying for each network.

--- plot_expm.m
Display Figures 1A and 1C.



------------------
 Folder: Network
------------------

--- determ_synburst.m
From Julia data (PER, freq, …) obtained for each circuit, this function determines the state of the circuit (silent, tonic mode, synchron. bursting, asynchron. Bursting)

--- plot_expm.m
Display Figure 2A

--- prop_computation.m: 
Load data generated by Julia
Call function determ_synburst.m
Compute proportion of rhythmic circuits

--- switch_bar.m
Display Figure 2B

-------------
 Folder: TAU
-------------
--- determ_synburst.m
From Julia data (PER, freq, …) obtained for each circuit, this function determines the state of the circuit (silent, tonic mode, synchron. bursting, asynchron. Bursting)


--- plot_tau_curve.m
Function comparing major time constant in a given model.

--- prop_tau.m
Same role as prop_computation.m when time constant is varying.

--- tau_collect_Vtheq.m
Same as Figure 3B-C when the threshold voltage is equal to -50mV for each time constant function.

--- tau_collect.m
Display Figure 3B-C (in our case, the threshold voltage is adapted for each model, since the spike has a different shape in each model).




-------------
 Folder: LFP
-------------

--- LFP_figure_modele.m
Display spectrograms in Figures 4B and 4D (bottom) by calling LFP_figure.m with adapted spectrogram parameters for each model.

--- LFP_figure.m
Load Julia data (LFP recording) and compute the LFP spectrogram.

--- plot_LFP.m
Display Figures 4B and 4D (top) - LFP recording obtained from Julia data.

--- plot_V.m
Function to display recorder membrane voltage to check the shape of the simulation.


-----------------
 Folder: LFP_TAU
-----------------
--- LFP_curve.m
From Julia data (LFP recording), this function processes LFP traces, zoom versions and LFP spectrogram.

--- LFP_figure_modele.m
Display LFP traces and LFP spectrogram by calling LFP_curve.m for each model with the appropriate spectrogram parameters.

--- LFP_figure.m
Load Julia data (LFP recording) and compute the LFP spectrogram.

--- Plot_LFP.m
Display LFP recording from Julia data.


----------------------
Folder: DIC
----------------------
For each model, you will find the same code adapted with the equations associated to each model:  I am presenting the folder Drion. 
DIC>Drion>Julia: contains the codes of the model equations and the function to solve the differential equations (Drion_model_DIC_KD.jl) and the code with the parameter values and to launch the solver (Simu_Drion_DIC_KD.jl) in Julia. 

DIC>Drion>phaseplane: contains the codes to generate Fig6 and Fig7 and all the functions that permits the reduction of the model 1 and the visualization of the phase portrait. 

--- boltz.m
Theoretical equation for the steady state formule of the activation and inactivation variable

--- build_var_cont_anal_KD.m
When a model is reduced following the dynamic input conductance protocols, the activation and inactivation variables are replaced by a weighted sum. This function is useful to compute the weight for the CaT activation at different scaled time constant.

--- calcul_SN.m
This code computes the saddle node bifurcation under different CaT activation channel time constant. It saves the symbolic equation of the V-nullcline in a cell called saveNULL.mat

--- DIC_X.m
Function computing the weighting sum of the activation or inactivation variable (mi(V) or hi(V)).

--- dist_DIC.m
Function computing the weights for the dynamic input conductance decomposition [Drion, 2015]

--- dV.m
Derivative of the membrane voltage (used in the differential equation resolution of dV/dt)

--- dVs_KD.m
Derivative of the slow variable (used in the differential equation resolution of dVs/dt)
	
--- dVus.m
Derivative of the ultraslow variable (used in the differential equation resolution of dVus/dt)

--- Final_Figure_Cvar.m
Code used to obtain Fig7 (by loading the saved equations of the null clines) 

--- Final_Figure.m
Code associated to Fig6. Change the idx value to see the result under the fast, slow and ultraslow conditions.

--- hCaTinf.m, hNainf.m, mCaTinf.m, mHinf.m, mKCainf.m, mKdinf.m, mNainf.m
Steady state equation of the activation and inactivation variables

--- plot_contribution.m
Code generating plots of the weights (DIC) at different CaT activation time constant. 

--- saveC.mat
Cell array containing the recording of V and the nullcline evaluated at the saddle node bifurcation

--- saveNULL.mat
Cell array containing the nullcline evaluated at the saddle node bifurcation, the value of Vus at the saddle node bifurcation, the recording of V, Vs and Vus

--- Simu_Drion_DIC_C.m
This code solves the differential equations associated to the model 1 for different membrane capacitance. It generates videos in mp4 format or in Matlab (evolution of the membrane voltage simultaneously with the evolution of its phase portrait). It also allows visualisation of the phase portrait in tonic mode or at a given time. 

--- Simu_Drion_DIC_KD.m
This code solves the differential equations associated to the model 1 for different time constant of CaT channel activation. It generates in mp4 format or in Matlab (evolution of the membrane voltage simultaneously with the evolution of its phase portrait). It also allows visualisation of the phase portrait in tonic mode or at a given time. 

--- tauhCaT.m, tauhNA.m, taumCaT_VAR.m, taumH.m, taumNa.m
Time constant function of the activation and inactivation variables

--- tauX.m
Theoretical equation for the time constant of the channel activation and inactivation.

--- var_contribution_SYM.m
Function to check the weights (DIC) written as symbolic equations (useful shape to plot the nullcline)

--- var_contribution.m
Function that compute the weights (DIC) in numerical form

--- varCOEF.mat
Cell array containing the parameter values (or scaling factor) of the current and conductances for the reduced model 1. Each line is associated to a different scale CaT time constant. 

--- video_PP_deform.m
Function generating the video of the phase portrait evolution at different scaled CaT time constant.


